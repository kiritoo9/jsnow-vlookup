/*
  JSNOW VLOOKUP LIBRARY
  author: Jon Snow
  version: 1.1.1
*/
"use strict"; !function (a) { async function e(e, i, s = null, o = 1, n = !1) { a("#" + e).after('<i id="jsnow-vlookup-init-loading">Loading..</i>'), await fetch(i.serverside.url, { method: "POST", body: JSON.stringify({ columns: i.serverside.columns, limit: i.limit, offset: i.limit * o - i.limit, searchValue: s }) }).then(async s => { let d = await s.json(), r = []; d.data.forEach(a => { let e = {}; Object.keys(a).forEach(t => { let l = !1; i.serverside.columns.forEach(a => { a.column.toString() == t.toString() && (l = !0) }), l && (e[t] = null == a[t] ? "-" : a[t]) }), Object.keys(e).length > 0 && r.push(e) }), a("#jsnow-vlookup-init-loading").remove(), a("#jsnow-vlookup-loading-search").hide(), n ? (i.data = r, t(e, i, d.total)) : l(e, i, r, o, d.total) }).catch(async a => { console.error(await a) }) } function t(t, i, s = 0) { var o = "", n = i.data.length > 5 ? "modal-lg" : ""; o += '<div class="modal fade" id="modal-' + t + '">', o += '<div class="modal-dialog ' + n + '">', o += '<div class="modal-content">', o += '<div class="modal-header">', o += '<h4 class="modal-title">' + i.title + "</h4>", o += '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>', o += "</div>", o += '<div class="modal-body">', o += '<div class="form-group jsnow-vlookup-search">', o += '<input type="text" style="font-size:13px" id="jsnow-vlookup-search-value" class="form-control" placeholder="Search..">', o += "</div>", o += '<p id="jsnow-vlookup-loading-search" style="display:none">Please wait...</p>', o += '<table class="table table-bordered table-hover">', o += "<thead>", o += "<tr>", Object.keys(i.data[0]).forEach(a => { o += '<th style="font-size: 13px;">' + a.replace(/_/g, " ").toUpperCase() + "</th>" }), o += "</tr>", o += "</thead>", o += '<tbody id="jsnow-vlookup-append"></tbody>', o += "</table>", o += "</div>", o += '<div class="modal-footer">', o += '<button style="font-size:13px" type="button" class="btn btn-danger" data-dismiss="modal">Cancel!</button>', o += "</div>", o += "</div>", o += "</div>", o += "</div>", a("#modal-" + t).length <= 0 && (a("#" + t).after(o), l(t, i, i.data, null, s), a("#modal-" + t).find(a("div.jsnow-vlookup-search").css({ width: "50%", float: "right" }).bind("keyup", s => { var o = []; i.serverside.enabled ? (a("#jsnow-vlookup-loading-search").show(), e(t, i, s.target.value)) : (i.data.forEach(a => { var e = !0; Object.keys(a).forEach(t => { a[t].toString().toUpperCase().indexOf(s.target.value.toUpperCase()) > -1 && (e = !1) }), e || o.push(a) }), l(t, i, o)) }))), a("#modal-" + t).modal("show") } function l(t, i, s, o = null, n = 0) { var d = ""; s.forEach((a, e) => { e < parseInt(i.limit) && (d += "<tr>", Object.keys(a).forEach(t => { d += '<td style="font-size: 13px" data-index="' + e + '">' + a[t] + "</td>" }), d += "</tr>") }), a("#jsnow-vlookup-append").html(d), function (e, t, l) { a("#" + e).find(a("table > tbody > tr").css({ cursor: "pointer" }).bind("click", i => { const s = l[a(i.target).data("index")]; if (null != s) { let l = "default" == t.key ? s[Object.keys(s)[0]] : s[t.key]; a("#" + e).val(l, toString()), a("#modal-" + e).modal("hide") } })) }(t, i, s), function (t, i, s, o, n = 0) { '<nav style="float:right">', '<ul class="pagination">', '<li data-id="previous" class="page-item" id="jsnow-vlookup-firstpage">', '<a href="#" class="page-link">Previous</a>', "</li>", '<li data-id="next" class="page-item" id="jsnow-vlookup-lastpage">', '<a href="#" class="page-link">Next</a>', "</li>", "</ul>", "</nav>", a("#modal-" + t).find(a("nav").remove()).find(a("table").after('<nav style="float:right"><ul class="pagination"><li data-id="previous" class="page-item" id="jsnow-vlookup-firstpage"><a href="#" class="page-link">Previous</a></li><li data-id="next" class="page-item" id="jsnow-vlookup-lastpage"><a href="#" class="page-link">Next</a></li></ul></nav>')).find(a(".page-link").css({ fontSize: "13px" })), function (t, i, s, o, n = 0) { parseInt(i.limit) > 0 && (n = Math.ceil(n / parseInt(i.limit))); var d = ""; o = o || 1; for (var r = !1, c = 1; c <= n; c++)o - 1 >= 2 && !r && (r = !0, d += '<li class="page-item disabled"><a style="font-size:13px" class="page-link" href="#">...</a></li>'), c != o && c != o - 1 && c != o + 1 || (d += '<li data-id="' + c + '" class="page-item ' + (o == c ? "active" : "") + '"><a class="page-link" style="font-size:13px" href="javascript:void(0)">' + c + "</a></li>"); o < n - 1 && (d += '<li class="page-item disabled"><a style="font-size:13px" class="page-link" href="#">...</a></li>'); a("#modal-" + t).find(a("li").each((e, t) => { "jsnow-vlookup-firstpage" != a(t).attr("id") && "jsnow-vlookup-lastpage" != a(t).attr("id") && a(t).remove() })), a("#modal-" + t).find(a("li.page-item:first-child").after(d)).find(a(".page-item").bind("click", s => { if (a(s.target).hasClass("disabled")) return; a(".page-item").each((e, t) => { a(t).removeClass("active") }), a(s.target).parent().addClass("active"); let d = a(s.target).parent().data("id"); if (null != d) if ("previous" == d ? d = o > 1 ? o - 1 : 1 : "next" == d && (d = o < n ? o + 1 : n), i.serverside.enabled) a("#jsnow-vlookup-loading-search").show(), e(t, i, a("#jsnow-vlookup-search-value").val(), d); else { var r = i.limit * d - i.limit; i.data.forEach((a, e) => { e + 1 > r && c.length < i.limit && c.push(a) }); var c = []; l(t, i, c, d) } })) }(t, i, 0, o, n) }(t, i, 0, o, n) } a.fn.jsnowlookup = function (l) { var i = a.extend({ title: "Jsnow Vlookup", search: !0, limit: 10, key: "default", data: [], serverside: { enabled: !1, url: "", columns: [] } }, l); let s = !1; if (i.data.length > 0 && !i.serverside.enabled ? s = !0 : i.serverside.enabled ? s = !0 : console.error("You dont have any data yet!"), s) { const l = a(this).attr("id"); a(this).css({ cursor: "pointer" }).attr("readonly", !0).bind("click", a => { i.serverside.enabled ? i.serverside.columns.length <= 0 ? alert("You didnt define columns yet!") : e(l, i, null, 1, !0) : t(l, i) }) } } }(jQuery);