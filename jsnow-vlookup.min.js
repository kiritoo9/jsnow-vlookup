/*
  JSNOW VLOOKUP LIBRARY
  author: Jon Snow
  version: 1.1.1
*/
"use strict"; !function (a) { async function e(e, s, i = null, o = 1, n = !1) { const d = a("#" + e).attr("placeholder"); a("#" + e).attr("placeholder", "Loading.."), await fetch(s.serverside.url, { method: "POST", body: JSON.stringify({ columns: s.serverside.columns, limit: s.limit, offset: s.limit * o - s.limit, searchValue: i }) }).then(async i => { let r = await i.json(), c = []; r.data.forEach(a => { let e = {}; Object.keys(a).forEach(t => { let l = !1; s.serverside.columns.forEach(a => { a.column.toString() == t.toString() && (l = !0) }), l && (e[t] = null == a[t] ? "-" : a[t]) }), Object.keys(e).length > 0 && c.push(e) }), a("#" + e).attr("placeholder", d), a("#jsnow-vlookup-loading-search").hide(), n ? (s.data = c, t(e, s, r.total)) : l(e, s, c, o, r.total) }).catch(async a => { console.error(await a) }) } function t(t, s, i = 0) { var o = "", n = s.data.length > 5 ? "modal-lg" : ""; o += '<div class="modal fade" id="modal-' + t + '">', o += '<div class="modal-dialog ' + n + '">', o += '<div class="modal-content">', o += '<div class="modal-header">', o += '<h4 class="modal-title">' + s.title + "</h4>", o += '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>', o += "</div>", o += '<div class="modal-body">', o += '<div class="form-group jsnow-vlookup-search">', o += '<input type="text" style="font-size:13px" id="jsnow-vlookup-search-value" class="form-control" placeholder="Search..">', o += "</div>", o += '<p id="jsnow-vlookup-loading-search" style="display:none">Please wait...</p>', o += '<table class="table table-bordered table-hover">', o += "<thead>", o += "<tr>", Object.keys(s.data[0]).forEach(a => { o += '<th style="font-size: 13px;">' + a.replace(/_/g, " ").toUpperCase() + "</th>" }), o += "</tr>", o += "</thead>", o += '<tbody id="jsnow-vlookup-append"></tbody>', o += "</table>", o += "</div>", o += '<div class="modal-footer">', o += '<button style="font-size:13px" type="button" class="btn btn-danger" data-dismiss="modal">Cancel!</button>', o += "</div>", o += "</div>", o += "</div>", o += "</div>", a("#modal-" + t).length <= 0 && (a("#" + t).after(o), l(t, s, s.data, null, i), a("#modal-" + t).find(a("div.jsnow-vlookup-search").css({ width: "50%", float: "right" }).bind("keyup", i => { var o = []; s.serverside.enabled ? (a("#jsnow-vlookup-loading-search").show(), e(t, s, i.target.value)) : (s.data.forEach(a => { var e = !0; Object.keys(a).forEach(t => { a[t].toString().toUpperCase().indexOf(i.target.value.toUpperCase()) > -1 && (e = !1) }), e || o.push(a) }), l(t, s, o)) }))), a("#modal-" + t).modal("show") } function l(t, s, i, o = null, n = 0) { var d = ""; i.forEach((a, e) => { e < parseInt(s.limit) && (d += "<tr>", Object.keys(a).forEach(t => { d += '<td style="font-size: 13px" data-index="' + e + '">' + a[t] + "</td>" }), d += "</tr>") }), a("#jsnow-vlookup-append").html(d), function (e, t, l) { a("#" + e).find(a("table > tbody > tr").css({ cursor: "pointer" }).bind("click", s => { const i = l[a(s.target).data("index")]; if (null != i) { let l = "default" == t.key ? i[Object.keys(i)[0]] : i[t.key]; a("#" + e).val(l, toString()), a("#modal-" + e).modal("hide") } })) }(t, s, i), function (t, s, i, o, n = 0) { '<nav style="float:right">', '<ul class="pagination">', '<li data-id="previous" class="page-item" id="jsnow-vlookup-firstpage">', '<a href="#" class="page-link">Previous</a>', "</li>", '<li data-id="next" class="page-item" id="jsnow-vlookup-lastpage">', '<a href="#" class="page-link">Next</a>', "</li>", "</ul>", "</nav>", a("#modal-" + t).find(a("nav").remove()).find(a("table").after('<nav style="float:right"><ul class="pagination"><li data-id="previous" class="page-item" id="jsnow-vlookup-firstpage"><a href="#" class="page-link">Previous</a></li><li data-id="next" class="page-item" id="jsnow-vlookup-lastpage"><a href="#" class="page-link">Next</a></li></ul></nav>')).find(a(".page-link").css({ fontSize: "13px" })), function (t, s, i, o, n = 0) { parseInt(s.limit) > 0 && (n = Math.ceil(n / parseInt(s.limit))); var d = ""; o = o || 1; for (var r = !1, c = 1; c <= n; c++)o - 1 >= 2 && !r && (r = !0, d += '<li class="page-item disabled"><a style="font-size:13px" class="page-link" href="#">...</a></li>'), c != o && c != o - 1 && c != o + 1 || (d += '<li data-id="' + c + '" class="page-item ' + (o == c ? "active" : "") + '"><a class="page-link" style="font-size:13px" href="javascript:void(0)">' + c + "</a></li>"); o < n - 1 && (d += '<li class="page-item disabled"><a style="font-size:13px" class="page-link" href="#">...</a></li>'); a("#modal-" + t).find(a("li").each((e, t) => { "jsnow-vlookup-firstpage" != a(t).attr("id") && "jsnow-vlookup-lastpage" != a(t).attr("id") && a(t).remove() })), a("#modal-" + t).find(a("li.page-item:first-child").after(d)).find(a(".page-item").bind("click", i => { if (a(i.target).hasClass("disabled")) return; a(".page-item").each((e, t) => { a(t).removeClass("active") }), a(i.target).parent().addClass("active"); let d = a(i.target).parent().data("id"); if (null != d) if ("previous" == d ? d = o > 1 ? o - 1 : 1 : "next" == d && (d = o < n ? o + 1 : n), s.serverside.enabled) a("#jsnow-vlookup-loading-search").show(), e(t, s, a("#jsnow-vlookup-search-value").val(), d); else { var r = s.limit * d - s.limit; s.data.forEach((a, e) => { e + 1 > r && c.length < s.limit && c.push(a) }); var c = []; l(t, s, c, d) } })) }(t, s, 0, o, n) }(t, s, 0, o, n) } a.fn.jsnowlookup = function (l) { var s = a.extend({ title: "Jsnow Vlookup", search: !0, limit: 10, key: "default", data: [], serverside: { enabled: !1, url: "", columns: [] } }, l); let i = !1; if (s.data.length > 0 && !s.serverside.enabled ? i = !0 : s.serverside.enabled ? i = !0 : console.error("You dont have any data yet!"), i) { const l = a(this).attr("id"); a(this).css({ cursor: "pointer" }).attr("readonly", !0).bind("click", a => { s.serverside.enabled ? s.serverside.columns.length <= 0 ? alert("You didnt define columns yet!") : e(l, s, null, 1, !0) : t(l, s) }) } } }(jQuery);